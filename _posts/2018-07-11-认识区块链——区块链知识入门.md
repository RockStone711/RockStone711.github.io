---
layout:     post                    # 使用的布局（不需要改）
title:      认识区块链——区块链知识入门               # 标题 
subtitle:   个人关于区块链原理的一些解读和理解  #副标题
date:       2017-07-11              # 时间
author:     庳城                      # 作者
header-img: img/post-bg-2015.jpg    #这篇文章标题背景图片
catalog: true                       # 是否归档
tags:                               #标签
    - 区块链
    - 学习总结
---
# 认识区块链——区块链知识入门
## 为什么要使用区块链？
中本聪是为了解决金融交易过程中，第三方信用机构参与带来的成本问题。第三方机构的本质是为了保证交易的可信度。这个问题的本质是信用问题，这代表了区块链的一个属性——共识机制（激励机制、去中心化），同时也为区块链附加了另一个属性——去中心化。人们对于区块链的所有应用场景的猜想都是围绕共识机制和去中心化展开的。
## 什么是区块链（区块链1.0）？
回归本源，我们先从中本聪的原本目的入手，即“比特币”，来了解什么是区块链。交易中的什么行为需要第三方信用机构去避免？这个问题就是双花问题。

>双花问题：在没有第三方机构的前提下，A有500元（或者叫500一般等价物），A将这500元给了B，同时又将这500元给了C，这就产生了双花问题。

传统的解决办法是通过国家、银行、担保人等方式，通过大量的人力物力进行记账、核账来避免双花问题。区块链1.0则是通过“广而告之”的方法来解决这个问题的。

假设这个有5个人——A、B、C、D、E、F，其中A是不诚实的，其余的人均是诚实的。很明显，想要避免A双花的最有效的办法是每个人将每一笔交易记录按照一定顺序保存下来，A的不诚实交易将不会被认可。

把这个问题放大到全世界，每一个人就相当于一个计算机节点的话（实际上一个人可以拥有多个节点），节点在发起一笔交易的时候，将这笔交易广播出去告知其他所有节点，这些节点会按照一定的规则和顺序共同去记录一个账单，这个账单上的记录不可伪造、不可修改，这个账单就可以保证双花问题不会出现。

但其中又产生了几个新的问题：

> 1. 交易的是什么？
> 2. 交易是如何形成账单的？记录的规则和顺序是什么？
> 3. 账单是如何保证不可伪造、不可修改的？
> 4. 节点为什么愿意记录交易？
> 5. 这些账单是如何在各个节点节达成共识的？

上述的几个问题分别对应的是区块链1.0的核心逻辑，接下来我们一条一条的解释.

### 1. 交易的是什么？(比特币的本质，非对称加密)

在比特币体系中，交易的自然是比特币，但是由于失去了第三方机构的信用保证，同时又是在数字（虚拟）环境中进行的交易，比特币本身是没有实际价值。现实中比特币的价值来源于一部分人认为它有价值。这就成为了很多人质疑比特币的理由之一，在这个唯心的价值判断方式下，比特币价格波动剧烈也是必然结果。

既然比特币没有实际价值，不由第三方机构保证，那么比特币到底是什么？

>“比特币本质上是一串数据链，这个链由一条一条交易按照发生的顺序组成，而“币”是不存在的，“币”是由链条上的交易推算出来的，本身并没有直接的“币”出现。”（摘自[《比特币白皮书 个人翻译+注解》](https://zhuanlan.zhihu.com/p/25039679)）

将交易连接成链的原理是每一个交易记录的信息中包含着上一笔交易记录的信息，付款人的身份标示、收款人的身份标示、交易数量和数字签名，通过交易上家和下家的对应关系将每一笔交易连接起来。

这里提到的“身份标示”，指的就是公钥。公钥的概念来源于非对称加密，这种加密方式首先会产生一串随机数，这个随机数作为私钥。私钥通过计算可以得出一个唯一对应的哈希数（HASH），这个哈希数（HASH）再进行计算可以得到一个唯一对应的公钥，私钥和公钥由于数学函数的限制，遵循正向可推，逆向不可推的原则；而哈希数和公钥正反都可推导。

>上文中提到的交易记录的信息的关系如下图所示（来源于《比特币白皮书》）：
>
>![](https://raw.githubusercontent.com/rickymorrison/rickymorrison.github.io/master/img/tx.png)

付款者A用自己的私钥对上一笔交易记录的信息、收款者B的公钥、交易数量进行数字签名（HASH），这个签名可以验证付款者A在上一笔交易记录的信息中的收款者身份，通过同理的不断反向追溯，付款者A可以证明自己有钱可转；收款者B可以利用自己的私钥去验证这一笔交易中付款者B的公钥，证明自己在这笔交易中的收款人身份。

这个机制是比特币数量记录的基础，但是并非所有节点都是诚实节点，一旦某一节点不诚实，进行了双花，这个链条将无法保证两笔交易中哪一笔是诚实的，哪一笔是不诚实的。因此仅仅记录交易链条是不够的，还需要将这个链条形成账单，即为交易赋予时序。

### 2. 交易是如何形成账单的？记录的规则和顺序是什么？（区块的形成）
在比特币体系中，账单可以理解为拥有时间顺序的交易链。当双花问题发生时，时间顺序可以区分某一不诚实节点发出的两笔交易中，哪一笔是有效的，哪一笔是无效的，这个无效的交易将不会被记录在账单中，循环往复的执行会不断的加强账单的正确性。

但是为每一笔交易添加时间信息是不明智的，基于工作量证明机制（之后会说明什么是工作量证明机制），为每一笔交易添加时间信息会极大的降低交易效率，在比特币体系中，采用了这样的一种模式：

>将一定数量的交易打包成区块，并对这个区块添加时间戳，然后为这个区块和该区块的上一个区块的HASH值进行HASH计算，并得到该区块的HASH值。
>
>![](https://raw.githubusercontent.com/rickymorrison/rickymorrison.github.io/master/img/block.png)

这样，每一个区块都按照时间顺序连接起来，一个新交易产生时，只需要验证该交易的发起公钥，找到这个公钥参与的上一次交易所在的区块，比对其时间信息，反复执行，即可查询到这个公钥上的余额，避免双花问题产生。在确认完区块内的所有交易有效后，这个区块会被认为是有效的诚实区块，被添加到区块链上，区块链上的交易将全部是有效交易。

### 3. 账单是如何保证不可伪造、不可修改的？（工作量证明）

在现实生活中，经常会听说做假账的消息，在区块链中也存在这样的风险，如果任何人都可以无成本的记录、伪造区块的话，区块链将会失去意义。因此在打包交易数据成区块的过程中引入工作量证明机制：
> 运用数学理论，为区块的生成赋予一定的难度（计算量），这个难度（计算量）需要消耗CPU（GPU）、内存和电力。CPU（GPU）、内存、和电力我们统称为算力。
>
> 保证账单不可伪造、不可修改的本质是通过工作量证明保证伪造和修改无法产生收益。

在这样的机制下，诚实节点会利有算力不断的生成区块，而不诚实的节点如果想要作恶，所需的算力必须超过全网大部分的算力，才能够重新生成已经生成的区块，并追赶上正在生成的区块。基于比特币的奖励机制（后文会提到），这样的做法明显得不偿失，不诚实节点付出的代价远高于比特币本身能够带给它的收益，没有人会为了骗取1元而付出100元的代价，同时拥有这么多算力去进行诚实交易带来的收益，也远比作恶带来的收益要高。但一旦发生了这样的事情，比特币体系将土崩瓦解，除非攻击者的目的不在于交易，而是比特币本身。

### 4. 节点为什么愿意记录交易？（奖励机制）

>打包区块的过程就是人们通常所说的挖矿。

即使是对比特币不是很了解的人或许都听说过一个词叫“挖比特币”，也就是说矿工挖矿是会收到比特币奖励的。进行过比特币交易的人可能知道，在交易过程中，帮助确认交易的矿工会收到手续费作为奖励。

>比特币体系是这样规定的，“每个区块的第一笔交易进行特殊化处理，该交易产生一枚由该区块创造者拥有的新的电子货币”（《比特币白皮书》），同时由于协助交易的确认也需要消耗算力，所以会从交易中抽成作为确认的奖励。

比特币体系中，规定了比特币的数量在2100万个，挖矿奖励激励人去将所有的比特币挖掘出来，交易费则作为比特币开采完毕后的区块生成的后续保证。但这个机制最大的问题是，在未来比特币开采完毕后，矿工的收益来源就只有交易费这一种了，一旦没有足够的比特币交易来维持交易量的话，将会有越来越少的节点参与计算，大量就交易将无人确认，最终整个比特币体系终将崩溃。

### 5. 这些账单是如何在各个节点节达成共识的？（网络广播、最长链、攻击与分叉）

交易记录链指代比特币、打包区块盖上时间戳、工作量证明保证区块不可修改、奖励机制激励人们参与其中，这一切看上去似乎万无一失，但是实际操作过程中就会发现这样一个问题——最新区块是第100个区块，有10个人同时在为第101个区块进行工作量证明，同时这10个人所打包的区块中的交易记录也各有不同，也就是说有10个完全不一样的区块在竞争链上第101的位置。如果这10个人都不认可对方的链，希望自己的区块成为第101，随后都在以自己的区块为基准的链上继续工作的话，原本的区块链将分裂成10条，那么之前的体系规则将毫无意义，比特币价值也将被分割。

因此在比特币体系中进行了这样的流程规定（运行网络的步骤）：

>1. 新的交易向全网进行广播
>2. 每个节点会随时在全网中抓取交易，抓取到的交易将被加入自己的内存中；
>3. 当交易达到一定数量后，每个节点将有效的交易打包成区块，并进行工作量证明；
>4. 当一个节点找到了一个工作量证明后，它就向全网进行广播；
>5. 当且仅当包含在该区块中的所有交易都是有效的且之前未存在过的，其他节点才认同该区块的有效性；
>6. 其他节点表示他们接受该区块，而表示接受的方法，则是在跟随该区块的末尾，制造新的区块以延长该链条。其他节点可能会接收到多个区块，原则上这些区块的产生是有时间差异的，节点会优先接受先收到的区块
>7. 节点始终将最长的链条视为正确的链条，并持续工作和延长它。同时节点会保存其他的竞争区块，以防竞争区块成为最长链。如果某一条竞争链成为了最长的链，节点将转换阵营，在这条链上工作。这个过程中，竞争链就称为分叉

最长链为主链的机制有效的解决的各个节点间信息不对称性和意见不一致的问题，最长链一定有比其他链更多的算力参与，而算力决定了产出区块的速度，即为话语权。算力越大话语权越高，但一旦算力超过一定比例以后，高算力的节点可以决定区块的产生速度、哪些交易不会被确认，甚至重写整个区块，这就叫做51%攻击（这个百分之51%是一个泛指概念，标示一个极大的算力）。但是前文已经说了，这种攻击是得不偿失的，所以除非抱有摧毁比特币体系的目的，是不会有人这么做的。

但是实际情况是，不用51%的算力就可以对某一笔交易进行攻击，举个例子来说：A是一个不诚实的节点，A给了B一个比特币，此时A应该是没有钱的，该笔交易被存储在区块256中，如果A想要进行双花，必须使分叉的长度超过当前的最长链。这种情况下区块链受到攻击并攻击成功的概率是较高的。经过概率计算后（比特币白皮书），我们可以知道当一个交易在经过后续的6个区块的确认后，需要极大的算力才可能攻击成功，所以通常来说一笔交易在加入区块后，需要等待至少有6个后续区块确认后，才可以确认该笔交易。

但是并非只有51%会对区块链造成冲击，各大算力集团之间的意见冲突也会对区块链造成巨大的冲击。如果集团A掌握30%算力，集团B掌握25%，集团C掌握25%，集团D掌握20%，集团A将在算力竞争中胜出，有能力产出绝大多数的区块。那么集团A就可以根据原本的比特币规则定义一个新的规则，如果这个新的规则可以被所有节点兼容，即不会被察觉，则称之为软分叉；但如果集团A内部要求所有节点升级，只有已经升级的节点才可以兼容新规则的区块，那么这种形式就被称为硬分叉。

软硬分叉的机制是在比特币发展的这些年中不断演化而来的，由于各种利益关系的冲突，比特币已经发生过了软硬分叉，如果有兴趣的话可以去了解一下。
## 区块链2.0

基于区块链1.0添加智能合约，可以在交易的同时自动履行数字合同。（有空补全2.0部分）

## 如何运用区块链？

区块链的应用主要集中在两个方面，一个是金融资产领域，一个是在计算机数据领域。

在金融领域，区块链可以提供更可靠的投资方案、资产信息，并保证交易的中间缓解更加透明、可信；而在计算机领域方面，可以有效的解决拜占庭将军问题，将各种硬件、软件设施统一起来，从而解决物联网难题、深度学习数据收集困难、ai测试数据不可靠的问题。网络上已经有很多人给出了区块链技术匹配的应用场景，与网络上场景雷同的就不在此赘述了。

## 结束语

如果对区块链感兴趣的话，最好还是仔细研究一下比特币白皮书和以太坊白皮书，比特币和以太坊分别标志着区块链1.0和区块链2.0，技术人员也可以去研究一下区块链源码。有能力可以阅读一下原版的英文白皮书，网络上中文翻译和注释讲解的文章也非常多，在此向大家推荐这两个版本：

[《比特币白皮书 个人翻译+注解》金晓](https://zhuanlan.zhihu.com/p/25039679)

[《[中文]以太坊白皮书》](https://github.com/ethereum/wiki/wiki/%5B%E4%B8%AD%E6%96%87%5D-%E4%BB%A5%E5%A4%AA%E5%9D%8A%E7%99%BD%E7%9A%AE%E4%B9%A6)
